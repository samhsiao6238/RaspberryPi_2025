# 自動化通知

_取得氣候資訊，並建立自動化通知服務，定時透過 Email 發送郵件給指定用戶_

<br>

## 氣候資訊

_詳細步驟後補_

<br>

1. 前往 [OpenWeather 官網](https://openweathermap.org/) 註冊並申請 `API Key`。

    ![](images/img_38.png)

<br>

## Gmail 應用程式密碼

_詳細步驟後補_

<br>

1. 申請 [應用程式密碼](https://myaccount.google.com/apppasswords)

    ![](images/img_13.png)

<br>

2. 複製備用。

    ![](images/img_14.png)

<br>

## 建立 n8n Workflow

1. 登入 n8n 後台，點選 `Create Workflows`

    ![](images/img_05.png)

<br>

2. 點左上方的預設名稱 `My workflow` 重新命名為 `天氣通知`。

    ![](images/img_06.png)

<br>

## 新增觸發節點

1. On a schedule

    ![](images/img_07.png)

<br>

2. 設定排程細節，完成後點擊 `Execute step`

    ![](images/img_08.png)

<br>

3. 新增 HTTP Request 節點，點 `+` 搜尋 `HTTP Request`

    ![](images/img_09.png)

<br>

4. 設定參數，Method 選 `GET`，`URL` 填入；`Taipei` 可替換為任意城市名，appid 填入註冊得到的 `API Key`。

    ```bash
    https://api.openweathermap.org/data/2.5/weather?q=Taipei&appid=<填入-API_KEY>&units=metric&lang=zh_tw
    ```

    ![](images/img_10.png)

<br>

5. 再次點擊 `Back to canvas` 繼續編輯。

    ![](images/img_11.png)

<br>

## 新增 Email 節點

1. 點節點下方的 `+` 搜尋 `Send Email`

    ![](images/img_12.png)

<br>

2. 填寫。

    ![](images/img_15.png)

<br>

3. `Subject` 可自訂如 `今日天氣預報`，格式可選 `Text` 或 `HTML`，Text 設定如下；這是使用 `{{$json["欄位"]}}` 語法提取節點 HTTP Response 的內容。

    ```bash
    今日天氣：{{$json["weather"][0]["description"]}}
    溫度：{{$json["main"]["temp"]}}°C
    體感溫度：{{$json["main"]["feels_like"]}}°C
    濕度：{{$json["main"]["humidity"]}}%
    ```

    ![](images/img_16.png)

<br>

## 測試並啟用

1. 每個節點可點擊旁邊 `▶` 單獨進行測試。

<br>

2. 順利收到信件後，點畫面上方「Inactive」開關，切到 `Active` 狀態

    ![](images/img_17.png)

<br>

3. 會彈窗提示。

    ![](images/img_18.png)

<br>

___

_END_
