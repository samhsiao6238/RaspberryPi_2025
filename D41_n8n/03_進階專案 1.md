# é€²éšå°ˆæ¡ˆ

_æ¨¹è“æ´¾ + n8n è‡ªå‹•åŒ–æ”å½±æ©Ÿåµæ¸¬ï¼‹å³æ™‚é€šçŸ¥_

## èªªæ˜

1. æ¨¹è“æ´¾åµæ¸¬æ”å½±æ©Ÿç•«é¢ä¸­æœ‰äººæ´»å‹•ï¼Œè‡ªå‹•è§¸ç™¼ n8n ç™¼é€é€šçŸ¥ã€‚

2. ä¸éœ€å¤–æ¥æ„Ÿæ¸¬å™¨ï¼Œåˆ©ç”¨åŸæœ¬çš„ USB æ”å½±æ©Ÿå³å¯


## æº–å‚™å·¥ä½œ

1. å®‰è£å¥½ n8n

2. MotionEye

3. USB æ”å½±æ©Ÿ

## motionEye

1. å®‰è£å¥—ä»¶

```bash
sudo apt update
sudo apt --no-install-recommends install ca-certificates curl gcc libjpeg62-turbo-dev libcurl4-openssl-dev libssl-dev -y
```

2. è¨­å®š pip.confï¼Œå…è¨±å…¨åŸŸå®‰è£ Python å¥—ä»¶ï¼ŒBookworm å¿…åš

```bash
grep -q '\[global\]' /etc/pip.conf 2> /dev/null || printf '%b' '[global]\n' | sudo tee -a /etc/pip.conf > /dev/null
sudo sed -i '/^\[global\]/a\break-system-packages=true' /etc/pip.conf
```

4. å®‰è£ motionEye

```bash
sudo python -m pip install --pre motioneye
```

5. åˆå§‹åŒ– motionEyeï¼Œå»ºç«‹ config èˆ‡ systemd æœå‹™

```bash
sudo motioneye_init
```

6. å•Ÿå‹• motionEye

```bash
sudo systemctl enable --now motioneye
```

7. é–‹å•Ÿç€è¦½å™¨é€²å…¥ç®¡ç†ä»‹é¢ `http://<ä½ çš„æ¨¹è“æ´¾IP>:8765`ï¼Œé è¨­å¸³è™Ÿ adminï¼Œå¯†ç¢¼ç•™ç©º

8. å‡ç´š motionEye

    ```bash
    sudo systemctl stop motioneye
    sudo python3 -m pip install --upgrade --pre motioneye
    sudo systemctl start motioneye
    ```

9. å¯è‡ªè¨‚ `config`ï¼Œåƒè€ƒï¼š[å®˜æ–¹ extra config/service æª”](https://github.com/motioneye-project/motioneye/tree/dev/motioneye/extra)

## è¨­å®šåµæ¸¬äº‹ä»¶é€šçŸ¥

1. ç™»å…¥ MotionEye [http://<æ¨¹è“æ´¾-IP>:8765ï¼‰]

2. åœ¨ `Motion Detection` ä¸­å¯é€é `Frame Change Threshold` è¨­å®šéˆæ•åº¦ã€‚

3. å•Ÿç”¨ã€ŒRun a commandã€åŠŸèƒ½ï¼ŒæŒ‡ä»¤ç‚ºï¼š

```bash
curl -X POST http://<æ¨¹è“æ´¾-IP>:5678/webhook/motion-detected
```

## å»ºç«‹ n8n Workflow

* Node 1ï¼šWebhook Trigger

  * HTTP Methodï¼šPOST
  * Pathï¼š`motion-detected`

* Node 2ï¼šHTTP Request (å¯é¸æŠ“å¿«ç…§)

  * Methodï¼šGET
  * URLï¼š`http://<pi-ip>:8765/<camera_path>/current.jpg`

* Node 3ï¼šSend Email æˆ– Send Telegram

  * æœ‰ HTTPè¼¸å…¥é™„å¸¶å¿«ç…§åœ–ç‰‡



## å®Œæ•´ç•«é¢æµç¨‹

```mermaid
graph TD
  A[MotionEye Motion Detected] --> B[n8n Webhook Trigger]
  B --> C[HTTP Request Snapshot]
  C --> D[Send Email/Telegram Notification]
```



### ğŸ“Œ åŸç†é‡é»

* MotionEye ç•¶åµæ¸¬åˆ°å‹•ä½œæ™‚ï¼Œæœƒå‘¼å« n8n Webhook
* n8n æ¥æ”¶åˆ°å¾Œå†æŠ“å¿«ç…§ + å¯„ä¿¡æˆ–é€šçŸ¥çµ¦ä½ 



