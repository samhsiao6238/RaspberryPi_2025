# é€²éšå°ˆæ¡ˆ

_æ¨¹è“æ´¾ + n8n è‡ªå‹•åŒ–æ”å½±æ©Ÿåµæ¸¬ï¼‹å³æ™‚é€šçŸ¥_

## å°ˆæ¡ˆç°¡ä»‹

1. æ¨¹è“æ´¾åµæ¸¬æ”å½±æ©Ÿç•«é¢ä¸­æœ‰äººæ´»å‹•ï¼Œè‡ªå‹•è§¸ç™¼ n8n ç™¼é€é€šçŸ¥ã€‚

2. ä¸éœ€å¤–æ¥æ„Ÿæ¸¬å™¨ï¼Œåˆ©ç”¨åŸæœ¬çš„ USB æ”å½±æ©Ÿå³å¯


## æº–å‚™å·¥ä½œ

1. å®‰è£å¥½ n8n

2. MotionEye

3. USB æ”å½±æ©Ÿ

## motionEye

1. å®‰è£å¥—ä»¶ã€‚

```bash
sudo apt update
sudo apt --no-install-recommends install ca-certificates curl gcc libjpeg62-turbo-dev libcurl4-openssl-dev libssl-dev -y
```

2. è¨­å®š pip.confï¼Œå…è¨±å…¨åŸŸå®‰è£ Python å¥—ä»¶ï¼ŒBookworm å¿…åšã€‚

```bash
grep -q '\[global\]' /etc/pip.conf 2> /dev/null || printf '%b' '[global]\n' | sudo tee -a /etc/pip.conf > /dev/null
sudo sed -i '/^\[global\]/a\break-system-packages=true' /etc/pip.conf
```

4. å®‰è£ motionEyeï¼›ç•¶å‰ç³»çµ± Python ç›´æ¥å®‰è£ motionEye æœ€æ–°é ç™¼è¡Œç‰ˆæœ¬ï¼Œ
å…¶ä¸­ `--pre` æŒ‡å®šå®‰è£ `é è¦½ç‰ˆ`ï¼Œå¯å–å¾—æœ€æ–°åŠŸèƒ½æˆ–ä¿®æ­£ã€‚

```bash
sudo python -m pip install --pre motioneye
```

5. åˆå§‹åŒ– motionEyeï¼Œå»ºç«‹ config èˆ‡ systemd æœå‹™ã€‚

```bash
sudo motioneye_init
```

6. è¨­å®šç‚ºé–‹æ©Ÿå•Ÿå‹•ã€‚

```bash
sudo systemctl enable --now motioneye
```

7. å…ˆå‡ç´š motionEyeã€‚

```bash
sudo systemctl stop motioneye
sudo python -m pip install --upgrade --pre motioneye
sudo systemctl start motioneye
```

8. é–‹å•Ÿç€è¦½å™¨é€²å…¥ç®¡ç†ä»‹é¢ `http://<ä½ çš„æ¨¹è“æ´¾IP>:8765`ï¼Œé è¨­å¸³è™Ÿ `admin`ï¼Œå¯†ç¢¼ç•™ç©ºã€‚

![](images/img_25.png)

9. å¯è‡ªè¨‚ `config`ï¼Œåƒè€ƒï¼š[å®˜æ–¹ extra config/service æª”](https://github.com/motioneye-project/motioneye/tree/dev/motioneye/extra)

## HTTP ç¶²å€

_å¯å…ˆé€²è¡Œè¤‡è£½å‚™ç”¨_

1. é€²å…¥ motionEyeï¼Œåœ¨å½±åƒä¸Šé»æ“Šå³éµï¼Œè¤‡è£½åœ–ç‰‡ç¶²å€

![](images/img_28.png)

2. ç¶²å€è§£æã€‚

```bash
http://<æ¨¹è“æ´¾-IP>:8765/picture/1/current/?_=<é˜²æ­¢å¿«å–çš„éš¨æ©Ÿåƒæ•¸>&_username=admin&_signature=<é©—è­‰èº«ä»½çš„å®‰å…¨ç°½ç« >
```

## è¨­å®šåµæ¸¬äº‹ä»¶é€šçŸ¥

1. ç™»å…¥ MotionEye [http://<æ¨¹è“æ´¾-IP>:8765ï¼‰]ï¼Œé»æ“Šæ·»åŠ æ”å½±æ©Ÿã€‚

![](images/img_26.png)

2. æ¥è‘—åœ¨å½ˆçª—ä¸‹æ‹‰é¸å–æ­£ç¢ºçš„æ”å½±æ©Ÿï¼Œç„¶å¾Œé»æ“Š `OK`ã€‚

![](images/img_27.png)

3. åœ¨ `Motion Detection` ä¸­å¯é€é `Frame Change Threshold` è¨­å®šéˆæ•åº¦ã€‚

## è¨­å®š

1. å•Ÿç”¨ `Run a command` åŠŸèƒ½ã€‚

```bash
curl -X POST http://<æ¨¹è“æ´¾-IP>:5678/webhook/motion-detected
curl -X POST http://192.168.1.125:5678/webhook/motion-detected
```

## å»ºç«‹ n8n Workflow

1. ç¯€é» 1ï¼šWebhook

HTTP Methodï¼šPOST
Pathï¼š`motion-detected`

2. ç¯€é» 2ï¼šHTTP Request

Methodï¼šGET
URLï¼š`http://<æ¨¹è“æ´¾-IP>:8765/<camera_path>/current.jpg`

```bash
http://<æ¨¹è“æ´¾-IP>:8765/<camera_path>/current.jpg
```

1. ç¯€é» 3ï¼šSend Email æˆ– Send Telegram

æœ‰ HTTPè¼¸å…¥é™„å¸¶å¿«ç…§åœ–ç‰‡



## å®Œæ•´ç•«é¢æµç¨‹

```mermaid
graph TD
A[MotionEye Motion Detected] --> B[n8n Webhook Trigger]
B --> C[HTTP Request Snapshot]
C --> D[Send Email/Telegram Notification]
```



### ğŸ“Œ åŸç†é‡é»

MotionEye ç•¶åµæ¸¬åˆ°å‹•ä½œæ™‚ï¼Œæœƒå‘¼å« n8n Webhook
n8n æ¥æ”¶åˆ°å¾Œå†æŠ“å¿«ç…§ + å¯„ä¿¡æˆ–é€šçŸ¥çµ¦ä½ 



