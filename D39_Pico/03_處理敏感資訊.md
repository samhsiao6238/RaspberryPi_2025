# Pico W 

_使用 MicroPython + VS Code，連線 Wi-Fi 並發送 LINE 通知_

<br>

## 敏感資訊

_MicroPython 開發板不會自動讀取電腦端的模組，必須手動上傳_

<br>

1. 添加腳本處理敏感資訊。

    ```bash
    touch mysecrets.py .gitignore
    ```

<br>

2. 編輯 `.gitignore`，將敏感資訊加入。

    ```bash
    secrets.py
    ```

<br>

3. 編輯 `mysecrets.py` 內容。

    ```bash
    # mysecrets.py
    SSID = "<SSID-名稱>"
    PASSWORD = "<SSID-密碼>"
    LINE_TOKEN = "<Line-權杖>"
    ```

<br>

3. 修改 `upload.sh`，添加腳本

    ```bash
    #!/bin/bash

    # 上傳 boot.py 與 main.py 到 Pico W
    mpremote connect auto fs cp boot.py :boot.py
    mpremote connect auto fs cp main.py :main.py
    # 添加
    mpremote connect auto fs cp mysecrets.py :mysecrets.py
    echo "✅ 上傳完成！"
    ```

<br>

4. 修改主腳本 `main.py`。

    ```python
    import urequests
    from boot import connect_wifi
    # 存放敏感資料的模組
    import mysecrets

    # WiFi 設定
    SSID = mysecrets.SSID
    PASSWORD = mysecrets.PASSWORD

    # LINE Notify 權杖
    LINE_TOKEN = mysecrets.LINE_TOKEN

    def send_line_notify(message):
        url = "https://notify-api.line.me/api/notify"
        headers = {
            "Authorization": f"Bearer {LINE_TOKEN}",
            "Content-Type": "application/x-www-form-urlencoded"
        }
        data = f"message={message}"
        response = urequests.post(url, headers=headers, data=data)
        print("回應碼：", response.status_code)
        response.close()

    # 主流程
    if connect_wifi(SSID, PASSWORD):
        print("✅ WiFi 已連線")
        send_line_notify("🎉🎉 Pico W 成功上線")
    else:
        print("❌ WiFi 連線失敗")
    ```

<br>

## 在 VS Code 撰寫與上傳程式碼

1. 建立專案資料夾如 `pico-line-notify`，編輯腳本 `boot.py`，作為 Wi-Fi 初始化。

    ```python
    import network
    import time

    def connect_wifi(ssid, password):
        wlan = network.WLAN(network.STA_IF)
        wlan.active(True)
        if not wlan.isconnected():
            print('正在連線到 WiFi...')
            wlan.connect(ssid, password)
            timeout = 10
            while not wlan.isconnected() and timeout > 0:
                time.sleep(1)
                timeout -= 1
        return wlan.isconnected()
    ```

<br>

2. 編輯 `main.py`，這是主程式，用來連網後發送 LINE 通知

    ```python
    import urequests
    from boot import connect_wifi
    # 存放敏感資料的模組
    import mysecrets

    # WiFi 設定
    SSID = mysecrets.SSID
    PASSWORD = mysecrets.PASSWORD

    # LINE Notify 權杖
    LINE_TOKEN = mysecrets.LINE_TOKEN

    def send_line_notify(message):
        url = "https://notify-api.line.me/api/notify"
        headers = {
            "Authorization": f"Bearer {LINE_TOKEN}",
            "Content-Type": "application/x-www-form-urlencoded"
        }
        data = f"message={message}"
        response = urequests.post(url, headers=headers, data=data)
        print("回應碼：", response.status_code)
        response.close()

    # 主流程
    if connect_wifi(SSID, PASSWORD):
        print("✅ WiFi 已連線")
        send_line_notify("🎉🎉 Pico W 成功上線")
    else:
        print("❌ WiFi 連線失敗")
    ```

<br>

3. 使用組合鍵上傳程式到 Pico W

<br>

___

_END_