

1. SSD 偵測狀態解析

```bash
lsblk -o NAME,SIZE,FSTYPE,MOUNTPOINT,LABEL,MODEL
```

## 掛載 NVMe SSD

1. 建立掛載點資料夾

```bash
sudo mkdir -p /mnt/ssd
```

2. 掛載 SSD 分割區

```bash
sudo mount /dev/nvme0n1p1 /mnt/ssd
```

3. 確認掛載成功

```bash
df -h | grep ssd
```

## 開機自動掛載：

1. 編輯 `/etc/fstab`

```bash
sudo nano /etc/fstab
```

2. 加入一行

```bash
/dev/nvme0n1p1  /mnt/ssd  ext4  defaults,nofail  0  2
```

3. 建立節點資料資料夾

```bash
sudo mkdir -p /mnt/ssd/geth
sudo mkdir -p /mnt/ssd/lighthouse
```

## 執行 Geth 節點（Execution Layer）

_先確認你已安裝 Geth（如果未安裝，請回覆我會協助）_

1. 安裝必要編譯工具

```bash
sudo apt update
sudo apt install -y build-essential git
```

2. 下載原始碼

```bash
git clone https://github.com/ethereum/go-ethereum.git
cd go-ethereum
```

3. 下載 Go 官方安裝檔

```bash
cd ~
wget https://go.dev/dl/go1.22.3.linux-arm64.tar.gz
```

4. 解壓並安裝到 /usr/local

```bash
sudo rm -rf /usr/local/go
sudo tar -C /usr/local -xzf go1.22.3.linux-arm64.tar.gz
```

5. 設定 PATH

```bash
echo "export PATH=\$PATH:/usr/local/go/bin" >> ~/.bashrc
source ~/.bashrc
```

6. 編譯 Geth

```bash
cd ~/go-ethereum
make geth
```

4. 編譯完成後移到可執行路徑

```bash
sudo cp build/bin/geth /usr/local/bin/
```

5. 驗證

```bash
geth version
```

6. 改變該資料夾所有者

```bash
sudo chown -R $USER:$USER /mnt/ssd/geth
```

## 開始

1. 誰佔用了 30303 埠

```bash
sudo lsof -i :30303
```

2. 刪除

```bash
sudo kill -9 <進程-PID>
```

7. 手動啟動 geth，第一次會自動產生 jwt 檔案與同步主網，需幾小時以上；目前狀況可等待它完成與其他節點連接並開始同步資料（需數小時至數天，依硬碟與網速而定）

```bash
geth \
    --datadir /mnt/ssd/geth \
    --http \
    --http.addr 0.0.0.0 \
    --http.api eth,net,web3 \
    --authrpc.addr localhost \
    --authrpc.port 8551 \
    --authrpc.vhosts=* \
    --authrpc.jwtsecret /mnt/ssd/geth/jwt.hex
```


## 執行 Lighthouse Beacon Node（共識層）

_另外開一個終端機_

1. 安裝 Rust

```bash
curl https://sh.rustup.rs -sSf | sh
source $HOME/.cargo/env
```

2. 安裝依賴工具

```bash
sudo apt update
sudo apt install -y build-essential clang pkg-config libssl-dev
sudo apt install -y git cmake pkg-config
```

3. 編譯 Lighthouse

```bash
git clone https://github.com/sigp/lighthouse.git
cd lighthouse
git checkout stable
make
```

4. 設定資料路徑

```bash
mkdir -p /mnt/ssd/lighthouse
```

5. 先停止

```bash
sudo pkill -f geth
sudo pkill -f lighthouse
```

6. 清除 HTTP 相關設定與快取

```bash
sudo rm -rf /mnt/ssd/lighthouse/beacon/checkpoint_sync
sudo rm -rf /mnt/ssd/lighthouse/beacon/http
sudo rm -rf /mnt/ssd/lighthouse/beacon/tmp
sudo rm -rf /mnt/ssd/lighthouse/beacon/lockfile
```

7. 啟動

```bash
sudo geth \
  --datadir /mnt/ssd/geth \
  --http \
  --http.addr 0.0.0.0 \
  --http.api eth,net,web3 \
  --authrpc.addr 127.0.0.1 \
  --authrpc.port 8551 \
  --authrpc.vhosts=* \
  --authrpc.jwtsecret /mnt/ssd/geth/jwt.hex
```

8. 另一個視窗啟動 Lighthouse Beacon Node

```bash
cd ~/lighthouse
sudo ./target/release/lighthouse bn \
  --network mainnet \
  --datadir /mnt/ssd/lighthouse \
  --execution-endpoint http://127.0.0.1:8551 \
  --execution-jwt /mnt/ssd/geth/jwt.hex \
  --checkpoint-sync-url https://mainnet.checkpoint.sigp.io \
  --http \
  --http-address 127.0.0.1 \
  --http-port 5152 \
  --metrics \
  --disable-upnp \
  --debug-level debug
```

7. 再開一個視窗，等 1~2 分鐘後，使用以下指令查看同步進度

```bash
curl http://127.0.0.1:5152/eth/v1/node/health
```

## 設定 systemd

_開機自動執行_

