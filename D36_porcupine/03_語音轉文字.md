# èªéŸ³è½‰æ–‡å­—

_é€™éƒ¨åˆ†å¯¦ä½œéå®˜æ–¹ç‰ˆæœ¬ï¼Œå› ç‚º Picovoice å®˜æ–¹èšç„¦åœ¨ `å–šé†’è©è¾¨è­˜`ï¼Œä¸»è¦æä¾›å³æ™‚å–šé†’èƒ½åŠ›_


## å®‰è£å·¥å…·

_èªéŸ³è½‰æ–‡å­—å·¥å…· `Whisper`_

1. æ¡ç”¨ OpenAI çš„ [Whisper](https://github.com/openai/whisper)ï¼Œé€™æ˜¯ä¸€æ¬¾é–‹æºã€æ•ˆæœæ¥µä½³çš„èªéŸ³è¾¨è­˜æ¨¡å‹ï¼›`Whisper` æœƒä½¿ç”¨ `ffmpeg` è™•ç†éŸ³è¨Šæ ¼å¼ï¼Œæ‰€ä»¥æœƒä¸€èµ·å®‰è£ã€‚

```bash
sudo apt install ffmpeg
pip install openai-whisper
```

## æ¸¬è©¦èªéŸ³è¾¨è­˜

1. éŒ„è£½èªéŸ³æª”ï¼Œè¨­å®šç‚º `5` ç§’

    ```bash
    arecord -D plughw:2,0 -f cd -t wav -d 5 -r 16000 test.wav
    ```

2. è¾¨è­˜èªéŸ³ï¼Œè‹¥æˆåŠŸï¼Œæœƒçœ‹åˆ°è¾¨è­˜å‡ºä¾†çš„å…§å®¹é¡¯ç¤ºåœ¨çµ‚ç«¯æ©Ÿã€‚

    ```bash
    whisper test.wav --model tiny --language Chinese
    ```

## æ•´åˆ Porcupine

_éŒ„éŸ³ â†’ Whisper â†’ å°å‡ºèªéŸ³æ–‡å­—_

1. å°ˆæ¡ˆçµæ§‹

```bash
exPicovoice/
â”œâ”€â”€ porcupine_wakeup_stt.py  â† ä¸»ç¨‹å¼
â”œâ”€â”€ ä½ å¥½æ¨¹è“æ´¾.ppn
â”œâ”€â”€ porcupine_params_zh.pv
```

2. ç·¨è¼¯è…³æœ¬ `porcupine_wakeup_stt.py`

```python
import pvporcupine
from pvrecorder import PvRecorder
import whisper
import os
import subprocess
from datetime import datetime

ACCESS_KEY = "<è¼¸å…¥-Access_Key>"
KEYWORD_PATH = "ä½ å¥½æ¨¹è“.ppn"
MODEL_PATH = "porcupine_params_zh.pv"

def record_audio(filename="recorded.wav", duration=5):
    print("ğŸ™ï¸ é–‹å§‹éŒ„éŸ³...")
    subprocess.run([
        "arecord", "-D", "plughw:2,0", "-f", "cd",
        "-t", "wav", "-d", str(duration), "-r", "16000", filename
    ])
    print("âœ… éŒ„éŸ³å®Œæˆï¼")

def transcribe_audio(filename="recorded.wav"):
    print("ğŸ§  é–‹å§‹è¾¨è­˜...")
    model = whisper.load_model("tiny")
    result = model.transcribe(filename, language="zh")
    print("ğŸ“ è¾¨è­˜çµæœï¼š", result["text"])

def main():
    porcupine = pvporcupine.create(
        access_key=ACCESS_KEY,
        keyword_paths=[KEYWORD_PATH],
        model_path=MODEL_PATH
    )
    recorder = PvRecorder(device_index=-1, frame_length=porcupine.frame_length)
    recorder.start()

    print("ğŸ§ ç­‰å¾…å–šé†’è©ã€Œä½ å¥½ï¼Œæ¨¹è“æ´¾ã€...")

    try:
        while True:
            pcm = recorder.read()
            result = porcupine.process(pcm)
            if result >= 0:
                print("ğŸš€ å–šé†’æˆåŠŸï¼")
                os.system('espeak "è«‹èªªå‡ºæ‚¨çš„æŒ‡ä»¤ã€‚"')
                record_audio()
                transcribe_audio()
    except KeyboardInterrupt:
        print("ğŸ›‘ åœæ­¢ä¸­...")
    finally:
        recorder.stop()
        recorder.delete()
        porcupine.delete()

if __name__ == "__main__":
    main()
```



## ğŸ§ª åŸ·è¡Œï¼š

```bash
python3 porcupine_wakeup_stt.py
```

å°éº¥å…‹é¢¨èªªã€Œä½ å¥½ï¼Œæ¨¹è“æ´¾ã€å¾Œï¼Œç³»çµ±æœƒéŒ„éŸ³ 5 ç§’ä¸¦è‡ªå‹•è½‰æ›æˆæ–‡å­—é¡¯ç¤ºå‡ºä¾†ã€‚



## âœ… å°çµ

| å…ƒä»¶            | ä½ å·²å®Œæˆ                      |
| - | - |
| Porcupine å–šé†’è© | âœ… ä¸­æ–‡é—œéµè©å¯è§¸ç™¼                |
| éŒ„éŸ³            | âœ… è‡ªå‹•éŒ„éŸ³ 5 ç§’                |
| Whisper èªéŸ³è¾¨è­˜  | âœ… ä½¿ç”¨ tiny æ¨¡å‹è½‰æˆä¸­æ–‡æ–‡å­—        |
| æ“´å……æ–¹å‘          | å¯ä¸²æ¥ ChatGPTã€æ§åˆ¶ GPIOã€å›è¦†èªéŸ³ç­‰ |



ğŸ“© è‹¥ä½ æƒ³ä¸‹ä¸€æ­¥å°‡æ–‡å­—è¼¸å…¥ ChatGPT å–å¾—èªéŸ³å›ç­”ï¼Œæˆ‘å¯ä»¥å¹«ä½ å†åŠ å…¥ã€ŒChatGPT å°è©± + å›æ‡‰èªéŸ³ã€çš„åŠŸèƒ½ï¼Œè¦å—ï¼Ÿ
