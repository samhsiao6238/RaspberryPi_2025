# 語音轉文字

_這部分實作非官方版本，因為 Picovoice 官方聚焦在 `喚醒詞辨識`，主要提供即時喚醒能力_


## 安裝工具

_語音轉文字工具 `Whisper`_

1. 採用 OpenAI 的 [Whisper](https://github.com/openai/whisper)，這是一款開源、效果極佳的語音辨識模型；`Whisper` 會使用 `ffmpeg` 處理音訊格式，所以會一起安裝。

```bash
sudo apt install ffmpeg
pip install openai-whisper
```

## 測試語音辨識

1. 錄製語音檔，設定為 `5` 秒

    ```bash
    arecord -D plughw:2,0 -f cd -t wav -d 5 -r 16000 test.wav
    ```

2. 辨識語音，若成功，會看到辨識出來的內容顯示在終端機。

    ```bash
    whisper test.wav --model tiny --language Chinese
    ```

## 整合 Porcupine

_錄音 → Whisper → 印出語音文字_

1. 專案結構

```bash
exPicovoice/
├── porcupine_wakeup_stt.py  ← 主程式
├── 你好樹莓派.ppn
├── porcupine_params_zh.pv
```

2. 編輯腳本 `porcupine_wakeup_stt.py`

```python
import pvporcupine
from pvrecorder import PvRecorder
import whisper
import os
import subprocess
from datetime import datetime

ACCESS_KEY = "<輸入-Access_Key>"
KEYWORD_PATH = "你好樹莓.ppn"
MODEL_PATH = "porcupine_params_zh.pv"

def record_audio(filename="recorded.wav", duration=5):
    print("🎙️ 開始錄音...")
    subprocess.run([
        "arecord", "-D", "plughw:2,0", "-f", "cd",
        "-t", "wav", "-d", str(duration), "-r", "16000", filename
    ])
    print("✅ 錄音完成！")

def transcribe_audio(filename="recorded.wav"):
    print("🧠 開始辨識...")
    model = whisper.load_model("tiny")
    result = model.transcribe(filename, language="zh")
    print("📝 辨識結果：", result["text"])

def main():
    porcupine = pvporcupine.create(
        access_key=ACCESS_KEY,
        keyword_paths=[KEYWORD_PATH],
        model_path=MODEL_PATH
    )
    recorder = PvRecorder(device_index=-1, frame_length=porcupine.frame_length)
    recorder.start()

    print("🎧 等待喚醒詞「你好，樹莓派」...")

    try:
        while True:
            pcm = recorder.read()
            result = porcupine.process(pcm)
            if result >= 0:
                print("🚀 喚醒成功！")
                os.system('espeak "請說出您的指令。"')
                record_audio()
                transcribe_audio()
    except KeyboardInterrupt:
        print("🛑 停止中...")
    finally:
        recorder.stop()
        recorder.delete()
        porcupine.delete()

if __name__ == "__main__":
    main()
```



## 🧪 執行：

```bash
python3 porcupine_wakeup_stt.py
```

對麥克風說「你好，樹莓派」後，系統會錄音 5 秒並自動轉換成文字顯示出來。



## ✅ 小結

| 元件            | 你已完成                      |
| - | - |
| Porcupine 喚醒詞 | ✅ 中文關鍵詞可觸發                |
| 錄音            | ✅ 自動錄音 5 秒                |
| Whisper 語音辨識  | ✅ 使用 tiny 模型轉成中文文字        |
| 擴充方向          | 可串接 ChatGPT、控制 GPIO、回覆語音等 |



📩 若你想下一步將文字輸入 ChatGPT 取得語音回答，我可以幫你再加入「ChatGPT 對話 + 回應語音」的功能，要嗎？
