# åŠ å…¥ K3s å¢é›†

_å°‡å…¶ä»–æ¨¹è“æ´¾è¨­å‚™åŠ å…¥å¢é›†_

## æº–å‚™å·¥ä½œ

1. ç³»çµ±è¨­å®š

```bash
sudo apt update && sudo apt upgrade -y
```

2. å®‰è£å¿…è¦å·¥å…·

```bash
sudo apt install -y curl iptables
```

3. å•Ÿç”¨ cgroup æ”¯æ´ï¼Œç¢ºä¿å·¥ä½œç¯€éƒ½å•Ÿç”¨äº† `cgroup_memory` å’Œ `systemd.unified_cgroup_hierarchy=1`

```bash
sudo nano /boot/firmware/cmdline.txt
```

4. åŠ å…¥åƒæ•¸

```bash
cgroup_memory=1 cgroup_enable=memory systemd.unified_cgroup_hierarchy=1
```

5. å„²å­˜ä¸¦é‡å•Ÿ

```bash
sudo reboot
```

## åŠ å…¥å·¥ä½œç¯€é»
åœ¨æº–å‚™å¥½çš„æ¨¹è“æ´¾ä¸Šå®‰è£ K3s Agentï¼ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

1. å®‰è£ K3s Agent
   ```bash
   curl -sfL https://get.k3s.io | K3S_URL=https://192.168.1.125:6443 K3S_TOKEN=<ä½ çš„ Master Node TOKEN> sh -
   ```

   - `K3S_URL`ï¼šMaster Node çš„ API åœ°å€ï¼ˆåœ¨æ­¤ä¾‹ä¸­ç‚º `https://192.168.1.125:6443`ï¼‰ã€‚  
   - `K3S_TOKEN`ï¼šå¾ Master Node ç²å¾—çš„ Tokenï¼ˆ`sudo cat /var/lib/rancher/k3s/server/node-token`ï¼‰ã€‚

2. æª¢æŸ¥å®‰è£æ—¥èªŒ
   ç¢ºä¿ Agent æ­£å¸¸å•Ÿå‹•ä¸¦é€£æ¥åˆ° Master Nodeï¼š
   ```bash
   sudo journalctl -u k3s-agent -f
   ```



### æ­¥é©Ÿ 3ï¼šç¢ºèªå·¥ä½œç¯€é»ç‹€æ…‹
åœ¨ Master Node ä¸ŠåŸ·è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œç¢ºèªæ–°ç¯€é»å·²æˆåŠŸåŠ å…¥ï¼š
```bash
sudo kubectl get nodes
```
å¦‚æœç¯€é»é¡¯ç¤º `Ready`ï¼Œå‰‡è¡¨ç¤ºå·¥ä½œç¯€é»å·²æˆåŠŸåŠ å…¥å¢é›†ã€‚



### æ­¥é©Ÿ 4ï¼šæ¸¬è©¦å·¥ä½œç¯€é»çš„åŠŸèƒ½
éƒ¨ç½²æ¸¬è©¦æ‡‰ç”¨ï¼Œç¢ºèª Pod å¯ä»¥åˆ†é…åˆ°æ–°åŠ å…¥çš„å·¥ä½œç¯€é»ä¸Šï¼š
```bash
kubectl create deployment nginx --image=nginx
kubectl expose deployment nginx --port=80 --type=NodePort
kubectl get pods -o wide
```



### å¾ŒçºŒå»ºè­°
- è‡ªå‹•åŒ–é€™äº›æº–å‚™æ­¥é©Ÿï¼ˆæˆ‘å¯ä»¥å¹«ä½ æ’°å¯«å®‰è£è…³æœ¬ï¼Œè®“æ¯å°æ¨¹è“æ´¾è‡ªå‹•å®Œæˆç’°å¢ƒé…ç½®ï¼‰ã€‚  
- ç›£æ§å¢é›†ç‹€æ…‹ï¼Œä½¿ç”¨ Prometheus å’Œ Grafana é€²è¡Œè³‡æºä½¿ç”¨åˆ†æã€‚  
- æ“´å±•å·¥ä½œç¯€é»æ•¸é‡ï¼Œæ ¹æ“šæ‡‰ç”¨è² è¼‰éœ€æ±‚éˆæ´»æ“´å……å¢é›†ã€‚

å¦‚æœä½ æƒ³è¦è…³æœ¬åŒ–è‡ªå‹•é…ç½®ï¼Œè«‹éš¨æ™‚å‘Šè¨´æˆ‘ï¼ ğŸ˜Š