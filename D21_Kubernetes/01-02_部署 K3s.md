# éƒ¨ç½² K3s

_å› ç‚º K8s éœ€è¦è€—ç”¨å¤§é‡è³‡æºï¼Œä¸å»ºè­°åœ¨é‚Šç·£è¨­å‚™å¦‚æ¨¹è“æ´¾ä¸Šéƒ¨ç½² K8sï¼Œä»¥ä¸‹å°‡é€²è¡Œ K3s éƒ¨ç½²ã€‚_ 

<br>

## é€£ç·šæ¨¹è“æ´¾

1. é€£æ¥æ¨¹è“æ´¾ã€‚

    ```
    ssh pi@<hostname>.local
    ```

<br>

2. ç¢ºèªç•¶å‰ IPï¼›ä»¥ä¸‹æŒ‡ä»¤æœƒåšç¯©é¸ã€åƒ…é¡¯ç¤º `æœ‰ç·šç¶²è·¯ eth0`ã€‚

    ```bash
    ip -4 addr show eth0 | grep inet | awk '{print $2}' | cut -d/ -f1
    ```

<br>

3. å¦‚æœæƒ³æŸ¥è©¢çš„æ˜¯ `ç„¡ç·šç¶²å¡ (wlan0)`ï¼Œå°‡ `eth0` æ›´æ”¹æˆ `wlan0` å³å¯ï¼›é€šå¸¸æœƒæ˜¯é€£è™Ÿçš„ IPï¼Œå…ˆæ˜¯æœ‰ç·šã€å†æ˜¯ç„¡ç·š ğŸ›œã€‚

    ```bash
    ip -4 addr show wlan0 | grep inet | awk '{print $2}' | cut -d/ -f1
    ```

<br>

4. å®Œæ•´æŸ¥è©¢ï¼›ä¾åºæœƒå¾—åˆ° `localhost`ã€æœ‰ç·šç¶²è·¯ã€ç„¡ç·šç¶²è·¯ä»¥åŠè™›æ“¬ç¶²è·¯æ¥å£å¦‚ `Docker` æˆ– `æ©‹æ¥ç¶²è·¯` åˆ†é…çš„åœ°å€ã€‚

    ```bash
    ip -4 addr show | grep inet | awk '{print $2}' | cut -d/ -f1
    ```

    ![](images/img_68.png)

<br>

# è¨­å®šå›ºå®š IP

_å…ˆä»‹ç´¹èˆŠç‰ˆä½œæ¥­ç³»çµ±çš„è¨­ç½®æ–¹å¼ï¼›ç‰¹åˆ¥æ³¨æ„ï¼Œæ–°ç‰ˆå·²ä¸å†ä½¿ç”¨ `/etc/dhcpcd.conf` é…ç½®éœæ…‹ IP_

<br>

1. ç·¨è¼¯ `/etc/dhcpcd.conf` æ–‡ä»¶ã€‚

    ```bash
    sudo nano /etc/dhcpcd.conf
    ```

<br>

2. è¨­å®šç‚ºéœæ…‹ IPã€‚

    ```
    interface wlan0
    static ip_address=<æ›´æ”¹ç‚º-æ¨¹è“æ´¾-IP>/24
    static routers=192.168.1.254
    static domain_name_servers=8.8.8.8
    ```

<br>

3. é‡æ–°å•Ÿå‹•ç¶²è·¯æœå‹™ã€‚

    ```
    sudo systemctl restart networking
    ```

<br>

## è¨­ç½®å›ºå®š IP

_æ–°ç‰ˆä½œæ¥­ç³»çµ±ä½¿ç”¨ `nmcli`ï¼Œé€™æ˜¯ NetworkManager çš„å‘½ä»¤è¡Œå·¥å…·_

<br>

1. æª¢æŸ¥ç•¶å‰çš„ç¶²è·¯ä»‹é¢åç¨±ï¼Œé€šå¸¸æ˜¯ eth0 æˆ– wlan0ã€‚

    ```bash
    nmcli device status
    ```

<br>

2. å°‡ç¶²è·¯ä»‹é¢ `wlan0` è¨­å®šç‚ºéœæ…‹ IPã€‚

    ```bash
    nmcli con modify wlan0 ipv4.addresses <æ›´æ”¹ç‚º-æ¨¹è“æ´¾-IP>/24
    nmcli con modify wlan0 ipv4.gateway 192.168.1.254
    nmcli con modify wlan0 ipv4.dns 8.8.8.8,8.8.4.4
    nmcli con modify wlan0 ipv4.method manual
    ```

<br>

3. é‡å•Ÿç¶²è·¯é€£ç·šï¼Œè®“è¨­å®šç”Ÿæ•ˆã€‚

    ```bash
    nmcli con down wlan0 && nmcli con up wlan0
    ```

<br>

## ç›´æ¥ä¿®æ”¹è¨­å®šæª”æ¡ˆ

1. åˆ—å‡ºç¾æœ‰é€£ç·šæª”æ¡ˆã€‚

    ```bash
    ls /etc/NetworkManager/system-connections/
    ```

<br>

2. è¼¯å™¨ä¿®æ”¹è©²æª”ã€‚

    ```bash
    sudo nano /etc/NetworkManager/system-connections/preconfigured.nmconnection
    ```

<br>

3. åœ¨ `[ipv4]` å€æ®µä¸­ï¼Œé è¨­ç‚º `method=auto`ã€‚

    ![](images/img_69.png)

<br>

4. ä¿®æ”¹å¦‚ä¸‹ã€‚

    ```bash
    [ipv4]
    method=manual
    addresses=<æ›´æ”¹ç‚º-æ¨¹è“æ´¾-IP>/24
    gateway=192.168.1.254
    dns=8.8.8.8;8.8.4.4;
    ```

<br>

5. å„²å­˜ã€é€€å‡ºä¸¦é‡å•Ÿ `NetworkManage`ï¼›ç‰¹åˆ¥æ³¨æ„ï¼Œé‡å•Ÿå¾Œï¼ŒåŸæœ¬çš„çµ‚ç«¯æ©Ÿç•«é¢æœƒå¡ä½ï¼Œè¦å¦å¤–é–‹å•Ÿæ–°çš„è¦–çª—ã€‚

    ```bash
    sudo systemctl restart NetworkManager
    ```

<br>

6. å¯é‡æ–°é–‹æ©Ÿç¢ºèªè¨­ç½®ã€‚

    ```bash
    sudo reboot now
    ```

<br>

7. é‡å•Ÿå¾Œæª¢æŸ¥ IPï¼›ç•¶å‰å› ç‚ºæœ‰ç·šç„¡ç·šçš†ä½¿ç”¨ç›¸åŒ IPï¼Œæ‰€ä»¥æœƒå¾—åˆ°èˆ‡ä¹‹å‰ä¸åŒçš„çµæœï¼Œé€™ä¹Ÿè¡¨ç¤ºè¨­å®šç”Ÿæ•ˆï¼Œè‹¥æƒ³è®“æœ‰ç·šå’Œç„¡ç·šç¶²å¡æ“æœ‰ä¸åŒçš„å›ºå®š IPï¼Œå¯ä»¥åˆ†åˆ¥è¨­å®šä¸åŒçš„éœæ…‹ IPã€‚

    ```bash
    ip -4 addr show | grep inet | awk '{print $2}' | cut -d/ -f1
    ```

<br>

## å•Ÿç”¨ cgroups

1. ç·¨è¼¯ `/boot/firmware/cmdline.txt`ã€‚

    ```bash
    sudo nano /boot/firmware/cmdline.txt
    ```

<br>

2. ç•¶å‰è¨­ç½®ï¼›ç‰¹åˆ¥æ³¨æ„ï¼Œä¸å¯æ›è¡Œï¼Œåƒæ•¸ä»¥é–“éš”è¡¨ç¤ºã€‚

    ```bash
    console=serial0,115200 console=tty1 root=PARTUUID=9ac2899b-02 rootfstype=ext4 fsck.repair=yes rootwait quiet splash plymouth.ignore-serial-consoles cfg80211.ieee80211_regdom=TW
    ```

<br>

3. åœ¨æœ€å³é‚ŠåŠ å…¥ä»¥ä¸‹åƒæ•¸ï¼›åˆ‡è¨˜ï¼Œä¸å¯æ–·è¡Œã€‚

    ```bash
    cgroup_memory=1 cgroup_enable=memory systemd.unified_cgroup_hierarchy=1
    ```

<br>

4. æ¥çºŒå®‰è£æ­¥é©ŸéŒ¢å¿…é ˆé‡å•Ÿç³»çµ±ã€‚

    ```bash
    sudo reboot
    ```

<br>

5. æª¢æŸ¥ç•¶å‰ç³»çµ±ä½¿ç”¨çš„ cgroup ç‰ˆæœ¬ã€‚

    ```bash
    mount | grep cgroup
    ```

<br>

6. æª¢æŸ¥ cgroup æ˜¯å¦å•Ÿç”¨äº† memoryï¼Œmemory çš„ enabled æ‡‰é¡¯ç¤ºç‚º 1ã€‚

    ```bash
    cat /proc/cgroups
    ```

<br>

## å®‰è£ K3s

1. åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤å®‰è£ K3sã€‚

    ```bash
    curl -sfL https://get.k3s.io | sh -
    ```

<br>

2. å®‰è£å®Œæˆå¾Œæª¢æŸ¥ K3s ç‹€æ…‹ã€‚

    ```bash
    sudo systemctl status k3s
    ```

<br>

3. æŸ¥çœ‹æ—¥èªŒã€‚

    ```bash
    journalctl -xeu k3s.service
    ```

<br>

4. ç¢ºèªç¯€é»ç‹€æ…‹ï¼Œè¡¨ç¤ºé€™å€‹ç¯€é»æ˜¯ `K3s` çš„ `ä¸»ç¯€é»`ï¼Œå°‡è² è²¬ç®¡ç† Kubernetes æ§åˆ¶å¹³é¢ã€‚

    ```bash
    sudo kubectl get nodes
    ```

<br>

5. ç¢ºèªç¯€é»è³‡æºç‹€æ…‹ã€‚

    ```bash
    sudo kubectl describe node raspi-2025-blue
    ```

<br>

6. æª¢æŸ¥æ‰€æœ‰å‘½åç©ºé–“ä¸­çš„ Podã€‚

    ```bash
    sudo kubectl get pods -A
    ```

<br>

___

_END_