_尚未成功_

# 樹莓派

_[參考](https://github.com/Huang-junsen/py-xiaozhi)，在樹莓派上安裝並運行小智 AI 聊天助理，可以依照以下步驟來設置。_

## 更新與安裝

1. 確保樹莓派系統是最新的

```bash
sudo apt update && sudo apt upgrade -y
```

2. 安裝依賴，因為 `py-xiaozhi` 需要音頻處理，所以需要安裝相關的 FFmpeg 和 PortAudio 等工具。

```bash
sudo apt install python3-pyaudio portaudio19-dev ffmpeg libopus0 libopus-dev -y
```

3. 下載 py-xiaozhi。

    ```bash
    cd ~/Documents && git clone https://github.com/Huang-junsen/py-xiaozhi.git && cd py-xiaozhi
    ```

4. 安裝依賴

    ```bash
    pip install -r requirements.txt
    ```

## 設置

1. 檢查麥克風

```bash
arecord -l
```

2. 檢查喇叭

```bash
lsusb
```

3. 手動測試 USB 麥克風錄音，使用組合鍵 `control+C` 停止錄音。

```bash
arecord -D plughw:3,0 -f cd test.wav
aplay test.wav
```

4. 編輯 ALSA 配置

```bash
sudo nano /etc/asound.conf
```

5. 添加以下內容

```bash
# 設定錄音設備（USB 麥克風 - card 1）
pcm.mic_in {
    type plug
    slave.pcm "hw:1,0"
}

ctl.mic_in {
    type hw
    card 1
}

# 設定播放設備（USB 喇叭 - card 2）
pcm.speaker_out {
    type plug
    slave.pcm "hw:2,0"
}

ctl.speaker_out {
    type hw
    card 2
}

# 設定預設設備
pcm.!default {
    type asym
    playback.pcm "speaker_out"
    capture.pcm "mic_in"
}
```

6. 儲存並重啟 ALSA

```bash
sudo alsactl init
```

7. 測試

```bash
arecord -D mic_in -f cd test.wav
aplay test.wav
```

## CLI 模式

_適用於終端機_

1. 樹莓派可使用 CLI 模式

```bash
python main.py --mode cli
```

## GUI 模式

_適用於桌面環境，運行 py-xiaozhi，可以選擇 GUI 模式 或 CLI 模式 來運行 小智 AI 助理。_

1. 運行

```bash
python main.py
```

2. 注意，GUI 模式需要 `tkinter`

```bash
sudo apt install python3-tk
```


## 步驟 6：測試與調整
1. 啟動後，會自動連接 小智 AI 伺服器（wss://api.tenclass.net/xiaozhi/v1/）。
2. 按住按鈕說話（GUI 模式）或 輸入 CLI 指令（CLI 模式）。
3. 若出現音量控制問題，可以手動安裝 ALSA：
   ```bash
   sudo apt install alsa-utils
   ```
4. 調整音量（若無法控制音量）
   ```bash
   amixer set PCM 90%
   ```



## 可選：使用 WebSocket 連接自建伺服器
如果不想使用官方伺服器，也可以自行部署 xiaozhi-esp32-server，然後修改 `main.py` 內的 WebSocket 連接地址。



### 總結
✅ 安裝系統依賴  
✅ 安裝 Python 依賴  
✅ 下載並運行 py-xiaozhi（支援 GUI & CLI 模式）  
✅ 測試語音互動  

這樣你的 Raspberry Pi 就能成功運行 小智 AI 聊天助理 了！🎉