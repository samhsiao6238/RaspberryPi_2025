# é–‹æ©Ÿé€šçŸ¥

_ä½¿ç”¨ `Line Messaging API` åœ¨æ¨¹è“æ´¾é–‹æ©Ÿæ™‚ç™¼é€é€šçŸ¥_

<br>

## æº–å‚™å·¥ä½œ

1. åœ¨ `Messaging API` ä¸­å–å¾— `Access Token`ï¼›é€™å€‹å°ˆæ¡ˆç„¡éœ€ `Channel Secret`ã€‚

<br>

2. _ä¸€éµå»ºç«‹è™›æ“¬ç’°å¢ƒ_ï¼Œå‘½åç‚º `envLineBot`ã€‚

    ```bash
    mkdir -p ~/Documents/PythonVenvs
    cd ~/Documents/PythonVenvs
    python -m venv envLineBot
    echo 'source ~/Documents/PythonVenvs/envLineBot/bin/activate' >> ~/.bashrc
    source ~/.bashrc
    ```

<br>

3. å®‰è£å¿…è¦å¥—ä»¶ã€‚

    ```bash
    pip install line-bot-sdk flask requests python-dotenv
    ```

<br>

## å»ºç«‹å°ˆæ¡ˆ

1. åœ¨æŒ‡å®šè·¯å¾‘ä¸­å»ºç«‹å°ˆæ¡ˆè³‡æ–™å¤¾ï¼Œé€™è£¡æœƒå»ºç«‹åœ¨ `~/Document/exLineMessage`ï¼Œä¸»è…³æœ¬å‘½åç‚º `line_message.py`ã€‚

    ```bash
    mkdir -p ~/Documents/exLineMessage
    cd ~/Documents/exLineMessage
    touch line_message.py .env .gitignore
    ```

<br>

2. ä½¿ç”¨ VSCode é€£ç·šæ¨¹è“æ´¾ã€‚

<br>

3. ç·¨è¼¯ `.gitignore`ã€‚

    ```bash
    .env
    ```

<br>

4. ç·¨è¼¯ `.env`ï¼›é›–ç„¶ä¸æœƒç”¨åˆ° `_CHANNEL_SECRET_`ï¼Œä½†é‚„æ˜¯å…ˆå­˜å…¥å‚™ç”¨ã€‚

    ```bash
    _CHANNEL_ACCESS_TOKEN_=<è²¼ä¸Š-TKOKEN>
    _CHANNEL_SECRET_=<è²¼ä¸Š-SECRET>
    _USER_ID=<è²¼ä¸Š-Your-user-ID>
    ```

<br>

5. ç·¨è¼¯ `line_message.py`ã€‚

    ```python
    import requests
    import os
    from dotenv import load_dotenv
    load_dotenv()

    # è®€å–
    _CHANNEL_ACCESS_TOKEN = os.getenv("_CHANNEL_ACCESS_TOKEN_")
    _CHANNEL_SECRET = os.getenv("_CHANNEL_SECRET_")
    _USER_ID = os.getenv("_USER_ID")

    # è¨­å®š LINE Messaging API Channel Access Token
    LINE_ACCESS_TOKEN = _CHANNEL_ACCESS_TOKEN
    # å¯åœ¨ LINE BotåŠ ç‚ºå¥½å‹å¾Œå–å¾—
    USER_ID = _USER_ID

    def send_line_message(message):
        url = "https://api.line.me/v2/bot/message/push"
        headers = {
            "Content-Type": "application/json",
            "Authorization": f"Bearer {LINE_ACCESS_TOKEN}"
        }
        payload = {
            # å¯æ”¹ç‚ºç¾¤çµ„ ID æˆ–å€‹äºº ID
            "to": USER_ID,
            "messages": [
                {"type": "text", "text": message}
            ]
        }
        response = requests.post(url, json=payload, headers=headers)
        return response.status_code, response.text

    if __name__ == "__main__":
        status, response_text = send_line_message("æ¨¹è“æ´¾å·²é–‹æ©Ÿï¼ğŸš€")
        print(f"ç‹€æ…‹ç¢¼: {status}, å›æ‡‰: {response_text}")
    ```

<br>

6. é‹è¡Œæ¸¬è©¦ã€‚

    ```bash
    python line_message.py
    ```

<br>

## é–‹æ©Ÿè‡ªå‹•åŸ·è¡Œ

_ä½¿ç”¨ `Linux` ç³»çµ±çš„é–‹æ©Ÿå•Ÿå‹•è…³æœ¬ï¼Œé©ç”¨æ–¼æ¨¹è“æ´¾ç³»çµ±_

<br>

1. ç·¨è¼¯ `rc.local`ã€‚

    ```bash
    sudo nano /etc/rc.local
    ```

<br>

2. è²¼ä¸Šä»¥ä¸‹å…§å®¹ï¼›åªåœ¨é–‹æ©Ÿæ™‚åŸ·è¡Œä¸€æ¬¡ï¼Œä¸¦å°‡è…³æœ¬æ”¾åˆ°èƒŒæ™¯åŸ·è¡Œï¼Œç„¶å¾ŒçµæŸ `rc.local`ã€‚

    ```bash
    #!/bin/bash

    # å»ºè­°åŠ ä¸€é»å»¶é²ï¼Œç¢ºä¿ç¶²è·¯èˆ‡ç³»çµ±è³‡æºæº–å‚™å¥½
    sleep 5

    # åˆ‡æ›å·¥ä½œç›®éŒ„ï¼ˆé‡è¦ï¼Œé¿å…ç¨‹å¼ä¾è³´ç›¸å°è·¯å¾‘éŒ¯èª¤ï¼‰
    cd /home/sam6238/Documents/exLineMessage

    # åŸ·è¡Œ Python è™›æ“¬ç’°å¢ƒå…§çš„è…³æœ¬ï¼ˆéèƒŒæ™¯ã€ä¸€æ¬¡æ€§ï¼‰
    /home/sam6238/Documents/PythonVenvs/envLineBot/bin/python line_message.py > /home/sam6238/Documents/exLineMessage/log.txt 2>&1

    exit 0
    ```

<br>

3. è®“æª”æ¡ˆå¯åŸ·è¡Œã€‚

    ```bash
    sudo chmod +x /etc/rc.local
    ```

<br>

4. ç«‹å³æ¸¬è©¦ï¼Œæœƒç­‰å¾…äº”ç§’é˜å¾Œé‹è¡Œã€‚

    ```bash
    sudo /etc/rc.local
    ```

<br>

5. æ¸¬è©¦é€šéï¼Œé‡æ–°å•Ÿå‹•æ¨¹è“æ´¾æ¸¬è©¦ã€‚

    ```bash
    sudo reboot
    ```

<br>

## æª¢æŸ¥

1. æŸ¥çœ‹ç¨‹å¼çš„ log è¼¸å‡ºã€‚

    ```bash
    cat /home/sam6238/Documents/exLineMessage/log.txt
    ```

<br>

2. è‹¥æ˜¯å¸¸é§èƒŒæ™¯çš„ç¨‹å¼ï¼Œå¯åŸ·è¡Œä»¥ä¸‹å‘½ä»¤ç¢ºèªæ˜¯å¦åœ¨åŸ·è¡Œã€‚

    ```bash
    ps aux | grep <è…³æœ¬åç¨±>
    ```

<br>

3. è‹¥æ˜¯å¸¸é§è…³æœ¬ï¼Œå‰‡ä½¿ç”¨ä»¥ä¸‹æ–¹å¼é€²è¡Œç›£çœ‹ã€‚

    ```bash
    tail -f <æ—¥èªŒè·¯å¾‘>
    ```

<br>

___

_END_
