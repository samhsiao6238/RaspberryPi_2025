# 透過網頁完成設置

<br>

## 設置使用者

_先設置使用者，這在容器內運行_

<br>

1. 進入 `openvpn-as` 容器。

   ```bash
   docker exec -it openvpn-as bash
   ```

<br>

2. 建立使用者 `openvpn` 及密碼 `Sam-112233`。

   ```bash
   cd /usr/local/openvpn_as/scripts && ./sacli --user openvpn --new_pass "Sam-112233" SetLocalPassword
   ```

   ![](images/img_53.png)

<br>

3. 將使用者 `openvpn` 設置為 `管理員 superuser`。

   ```bash
   cd /usr/local/openvpn_as/scripts
   ./sacli --user openvpn --key type --value admin UserPropPut
   ./sacli --user openvpn --key prop_superuser --value true UserPropPut
   ./sacli start
   ```

<br>

## 取得網頁管理網址

1. 在實例中運行，可取得 OpenVPN 管理介面網址。

   ```bash
   SERVER_IP=$(curl -s ifconfig.me)
   echo "管理介面: https://$SERVER_IP:943/admin"
   echo "客戶端介面: https://$SERVER_IP:943/"
   ```

<br>

2. 先登入管理頁面，帳號密碼在前面步驟所自定。

   ![](images/img_54.png)

<br>

3. 點擊 `Agree`。

   ![](images/img_80.png)

<br>

## 設定 IP

1. 登入管理頁面後，切換到 `Network Settings` 設置 `Hostname or IP Address` 為 `實例 IP`。

   ![](images/img_10.png)

<br>

2. 點擊下方的儲存。

   ![](images/img_41.png)

<br>

3. 點擊上方的更新。

   ![](images/img_42.png)

<br>

4. 點擊後會顯示 `無法連上 ...`，這是正常的，無需理會。

   ![](images/img_43.png)

<br>

5. 進入客戶端，輸入相同帳號密碼。

   ![](images/img_44.png)

<br>

6. 下載設定文件。

   ![](images/img_45.png)

<br>

7. 在本機先使用終端機指令啟動測試。

   ```bash
   openvpn --config <.ovpn-文件>
   ```

<br>

8. 確定可連線後再使用客戶端連線。

<br>

## 關於安全群組

_這裡記錄安全群組內容_

<br>

1. 當前的安全組。

   ![](images/img_09.png)

<br>

2. UDP 1194/1194，OpenVPN UDP。

<br>

3. TCP 9443/9443 是 OpenVPN Web UI 的管理頁面。

<br>

4. TCP 943/943 是OpenVPN Web UI 客戶端登入。

<br>

5. RDP TCP 3389 是遠端桌面 Windows。

<br>

6. ICMP 允許 ICMP Ping，可透過遠端透過 `ping` 指令進行連線測試。

<br>

7. TCP 22/22 是 SSH 連線。

<br>

## .ovpn 文件

1. 當前設定。

   ```bash
   # 加密演算法使用 AES-256-CBC 加密 VPN 流量
   cipher AES-256-CBC
   # 指定此配置用於客戶端模式
   client
   # 當客戶端嘗試連接伺服器時，最多等候 4 秒鐘
   server-poll-timeout 4
   # 不綁定本地端口
   # 允許客戶端使用動態端口，而不是固定的本地端口，適用於 NAT 環境
   nobind
   # 透過 TCP 連線到指定 IP 的 443 HTTPS 端口
   remote 8.136.110.37 443 tcp
   # 透過 UDP 連線到指定 IP 的 1194 OpenVPN 預設端口
   remote 8.136.110.37 1194 udp
   # 使用 TUN（Tunnel）介面，適用於 L3 隧道，路由模式
   dev tun
   # 明確指定設備類型為 TUN
   dev-type tun
   # 確保連接的伺服器提供有效的 TLS 憑證
   remote-cert-tls server
   # 只允許 TLS 1.2 以上的加密通訊，提升安全性
   tls-version-min 1.2
   # 設定 604800 秒（7 天）後，重新執行金鑰協商
   reneg-sec 604800
   # 設定最大傳輸單元，適合大部分網路環境的值，有助於減少封包分段
   tun-mtu 1420
   # 客戶端連接時，需要用戶名和密碼來進行身份驗證
   auth-user-pass
   # 日誌模式設定 `3`，顯示錯誤、警告與連線過程訊息
   verb 3
   # 讓伺服器接收客戶端的資訊
   # 客戶端會將一些系統資訊發送給伺服器
   push-peer-info

   <ca>
   -----BEGIN CERTIFICATE-----
   <略>
   -----END CERTIFICATE-----
   </ca>
   <cert>
   -----BEGIN CERTIFICATE-----
   <略>
   -----END CERTIFICATE-----
   </cert>
   <key>
   -----BEGIN PRIVATE KEY-----
   <略>
   -----END PRIVATE KEY-----
   </key>
   <tls-crypt-v2>
   -----BEGIN OpenVPN tls-crypt-v2 client key-----
   <略>
   -----END OpenVPN tls-crypt-v2 client key-----
   </tls-crypt-v2>
   ```

<br>

___

_END_
