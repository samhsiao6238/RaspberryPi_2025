# 樹莓派

_[參考](https://openvpn.net/as-docs/tutorials/tutorial--connect-with-linux.html#tutorial--connect-to-access-server-with-linux)，在樹莓派上使用 `OpenVPN 3 Linux` 或 `OpenVPN Open-Source CLI` 客戶端_

<br>

## 使用 OpenVPN 3 Linux

_這是一個較新的架構，允許非特權使用者啟動和管理 VPN 連線，並基於 D-Bus 提供更安全的操作模式。_

<br>

1. 確認系統支援並安裝必要套件

    ```bash
    sudo apt update && sudo apt install apt-transport-https curl -y
    ```

<br>

2. 下載 OpenVPN 的簽名金鑰並配置倉庫

    ```bash
    sudo mkdir -p /etc/apt/keyrings
    curl -sSfL https://packages.openvpn.net/packages-repo.gpg | sudo tee /etc/apt/keyrings/openvpn.asc
    echo "deb [signed-by=/etc/apt/keyrings/openvpn.asc] https://packages.openvpn.net/openvpn3/debian bookworm main" | sudo tee /etc/apt/sources.list.d/openvpn3.list
    ```

<br>

3. 更新倉庫並安裝 OpenVPN 3

    ```bash
    sudo apt update && sudo apt install openvpn3 -y
    ```

<br>

## 導入 `.ovpn` 配置文件

1. 查詢。

    ```bash
    cd ~/Downloads && ls *.ovpn
    ```

<br>

2. 從本機將伺服器提供的配置檔案傳送到樹莓派並更名為 `client.ovpn`。

    ```bash
    scp profile-5537574233513002673.ovpn sd:~/Downloads/client.ovpn
    ```

<br>

3. 導入配置檔案，`--persistent` 參數確保配置在系統重新啟動後仍然可用。

    ```bash
    openvpn3 config-import --config client.ovpn --persistent
    ```

    ![](images/img_35.png)

<br>

4. 查看已導入的配置檔案

    ```bash
    openvpn3 configs-list
    ```

<br>

## 啟動 VPN 連線

1. 使用導入的配置檔案啟動 VPN，輸入帳號密碼後完成連線。

    ```bash
    openvpn3 session-start --config client.ovpn
    ```

    ![](images/img_36.png)

<br>

2. 確認連線是否啟動

    ```bash
    openvpn3 sessions-list
    ```

    ![](images/img_37.png)

<br>

3. 如需停止 VPN 連線

    ```bash
    openvpn3 session-manage --config client.ovpn --disconnect
    ```

<br>

4. 在樹莓派訪問 `https://whatismyipaddress.com/`。

    ![](images/img_38.png)

<br>

## 驗證

1. 驗證是否成功連接到伺服器

    ```bash
    curl ifconfig.me
    ```

<br>

2. 查看日誌 

    ```bash
    sudo journalctl -u openvpn3
    ```

<br>

___

_接續下一單元_
