# 設置路由為客戶端

是的！如果您的目標是 讓整個區域網路 (LAN) 透過海外 VPN 伺服器連線，您需要在 DD-WRT 設定 OpenVPN 作為客戶端 (OpenVPN Client)。

這樣，您的路由器會建立 VPN 連線，並將所有網路設備（電腦、手機、智慧電視等）都通過 VPN 伺服器訪問外網。



# ✅ DD-WRT 設定 OpenVPN 客戶端
## 🔹 1. 取得 VPN 服務提供的 `.ovpn` 設定
- 如果您使用的是 商業 VPN（如 NordVPN、ExpressVPN、Surfshark），請從官方網站下載 OpenVPN 設定檔 (`.ovpn`)。
- 如果您自己架設了 VPN 伺服器，請確保有：
  - 伺服器地址（IP 或域名）
  - 連線埠號（UDP 1194 或 TCP 443 等）
  - CA 憑證 (`ca.crt`)
  - 用戶憑證 (`client.crt`)
  - 用戶私鑰 (`client.key`)
  - TLS 認證金鑰 (`ta.key`)（若伺服器有啟用 TLS 認證）



## 🔹 2. 登入 DD-WRT 並開啟 OpenVPN 客戶端
1. 進入 `Services → VPN`
2. 找到「OpenVPN Client」，設定如下：
   - Start OpenVPN Client → `Enable`

### ✅ 主要設定
| 參數             | 設定值 |
|--|-|
| Server IP/Name | 例如：`us1.vpnserver.com`（您的 VPN 伺服器地址） |
| Port | `1194`（或 VPN 服務商提供的） |
| Tunnel Device | `TUN` |
| Tunnel Protocol | `UDP`（或 `TCP`，依 VPN 服務商要求） |
| Encryption Cipher | `AES-256-CBC`（根據 VPN 服務提供商） |
| Hash Algorithm | `SHA256`（根據 VPN 服務提供商） |
| User Pass Authentication | `Enable`（如果 VPN 需要帳號密碼） |
| Username | `你的VPN帳號` |
| Password | `你的VPN密碼` |



## 🔹 3. 貼上憑證與密鑰
在 `VPN Client` 設定中，有幾個欄位需要填入 `.ovpn` 檔案中的憑證內容：

### ✅ CA Cert (`ca.crt`)
貼上 `.ovpn` 檔案內的 `<ca> ... </ca>` 內容：
```txt
--BEGIN CERTIFICATE--
(貼上 `ca.crt` 內容)
--END CERTIFICATE--
```

### ✅ Public Client Cert (`client.crt`)
貼上 `<cert> ... </cert>` 內容：
```txt
--BEGIN CERTIFICATE--
(貼上 `client.crt` 內容)
--END CERTIFICATE--
```

### ✅ Private Client Key (`client.key`)
貼上 `<key> ... </key>` 內容：
```txt
--BEGIN PRIVATE KEY--
(貼上 `client.key` 內容)
--END PRIVATE KEY--
```

### ✅ TLS Auth Key (`ta.key`，若需要)
如果 `.ovpn` 檔案內有 `<tls-auth> ... </tls-auth>`，請貼上：
```txt
--BEGIN OpenVPN Static Key V1--
(貼上 `ta.key` 內容)
--END OpenVPN Static Key V1--
```

⚠ 如果 VPN 伺服器沒有 TLS 認證金鑰 (`ta.key`)，請確保「TLS Cipher」設定為 `None`。



## 🔹 4. 設定 DNS 以避免 DNS 洩漏
1. 進入 `Setup → Basic Setup`
2. 在「Network Setup」中找到 `Static DNS`
   - DNS 1 → `8.8.8.8`（Google DNS）
   - DNS 2 → `1.1.1.1`（Cloudflare DNS）
   - DNS 3 → `8.8.4.4`（Google Backup DNS）
3. 勾選 `Forced DNS Redirection`
4. 點擊 `Save`，然後 `Apply Settings`



## 🔹 5. 確保 VPN 連線時所有設備都經過 VPN
1. 在 OpenVPN 設定的 `Additional Config` 欄位中，加入以下內容：
   ```
   route-nopull
   redirect-gateway def1
   ```
   - `route-nopull` → 避免 VPN 伺服器強制改變您的路由
   - `redirect-gateway def1` → 讓所有網路流量都經過 VPN



## 🔹 6. 防火牆規則
如果 VPN 連線後無法正常上網，請嘗試加入防火牆規則：
1. 進入 `Administration → Commands`
2. 輸入以下命令：
   ```sh
   iptables -I FORWARD -i tun1 -o br0 -m state --state RELATED,ESTABLISHED -j ACCEPT
   iptables -I FORWARD -i br0 -o tun1 -j ACCEPT
   iptables -t nat -A POSTROUTING -o tun1 -j MASQUERADE
   ```
3. 點擊「Save Firewall」，然後 「Apply Settings」。



## ✅ 7. 測試 VPN 是否正常運作
1. 進入 `Status → OpenVPN`
   - 查看 `State` 是否顯示 `Connected`
   - 如果未連線，請查看 `Log` 找出錯誤訊息。

2. 測試 IP 變化
   - 在連線 VPN 之前，開啟瀏覽器並訪問：
     ```
     https://www.whatismyip.com/
     ```
     記住當前的 IP 位址。

   - 開啟 VPN 並重新載入網站，應該會顯示 VPN 伺服器的 IP（來自海外）。



## 📌 總結
✅ 在 DD-WRT 設定 OpenVPN Client 以連線海外 VPN  
✅ 填入 `.ovpn` 憑證與金鑰  
✅ 設定 DNS 以避免 DNS 洩漏  
✅ 加入 `redirect-gateway def1` 確保所有流量經由 VPN  
✅ 查看 `Status → OpenVPN` 確保 VPN 已成功連線  
✅ 測試 `https://www.whatismyip.com/` 確認 IP 是否變更

請依照這些步驟設定 OpenVPN Client，然後回報結果！🚀