# 定時服務

_透過 Main UI 介面設定_

## 前置準備

_取得 LINE Notify Token_

## 安裝 HTTP Binding（Main UI 操作）

_利用 HTTP Binding，透過 REST API 向 LINE Notify 傳送訊息_

1. 開啟 OpenHAB Main UI，網址為 `<樹莓派-IP:8080>`。
2. 輸入帳號 `openhab` 並自訂密碼。

3. 進入 Settings > Add-ons，搜尋並安裝 HTTP Binding。

## 建立 LINE Notify 命令

_在 Main UI 中建立一個 HTTP Thing_

1. 前往 Settings > Things，點擊 +（Add） 按鈕。  

2. 選擇 HTTP Binding，然後新增一個自訂 HTTP Thing；Label 為 `LineNotify`、Location 填寫任意位置。

3. Base URL 填入 `https://notify-api.line.me/api/notify`。

4. 建立 Channel，點擊 `Add Channel`，Label 填入 `SendMessage`，類型選擇 `String Channel`


## 步驟 3：設定開機自動觸發規則
我們將使用 OpenHAB 的規則引擎（Rules Engine） 來設定開機時自動觸發的規則，並發送 LINE Notify 通知。

1. 新增規則
   - 前往 Settings > Rules，點擊 +（Add） 按鈕。  
   - 規則名稱：`Send Line Notify on Startup`

2. 設定觸發條件
   - When：選擇 `System started` 作為觸發條件（表示每次開機後觸發）。

3. 設定行動（Action）

    ```javascript
    val message = "Hello from OpenHAB!"  // 訊息內容
    val headers = newHashMap("Authorization" -> "Bearer WemrA5mtsqcBcvTEG59tXmVGVTDj8wifXH51GzjWXx8")  // 替換為你的 Token
    val result = sendHttpPostRequest(
        "https://notify-api.line.me/api/notify",
        "application/x-www-form-urlencoded",
        "message=" + URLEncoder::encode(message, "UTF-8"),
        headers
    )
    logInfo("LineNotify", "已發送 LINE Notify 訊息: " + result)
    ```



## 步驟 4：測試與驗證
1. 重新啟動 OpenHAB 服務或整個 Raspberry Pi：
   ```bash
   sudo systemctl restart openhab.service
   ```
2. 檢查你的 LINE 是否收到 「樹莓派已成功啟動！」 的通知。  
3. 如果有收到，則代表設定成功！



## 進階：將訊息內容動態化
你可以將通知訊息設為動態內容，包含：
- 開機時間  
- CPU 溫度  
- 網路 IP 位址

如需進一步自訂通知訊息，告訴我，我可以幫你擴展這個功能！ 😄