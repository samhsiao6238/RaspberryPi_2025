# 權限管理指令

_用來控制 Linux 系統中檔案與目錄的 `讀、寫、執行` 權限，以及設定或變更檔案 `擁有者` 與 `群組`。_

<br>

## `sudo`

1. 以 `root` 權限執行指令；`root` 就是 Linux 系統中的最高權限帳戶，擁有對系統所有檔案與指令的完全控制權限。

    ```bash
    # 以 root 權限執行更新
    sudo apt update
    ```

<br>

2. 若要在系統中以 `完整管理權限` 執行操作，可透過指令進入 `root shell`，在此之後所執行的操作都將以 `root` 權限執行。

    ```bash
    sudo -i
    ```

<br>

3. 切換為 root 身份後，命令行的提示符號會顯示目前身分與權限，原本一般使用者的提示符號為 `$`，超級使用者的提示符號是井字號 `#`；該設計主要目的是便於識別。

    ![](images/img_34.png)

<br>

## `chmod`

_更改檔案權限；表示方式有 `符號法` 與 `數字法`，兩者等效_

<br>

1. chmod 的完整語法是。

    ```bash
    chmod [who][operator][permissions] 檔案或目錄
    ```

<br>

2. `u+r`：給 `u 用戶` `+ 增加` `r 讀取` 權限。

    ```bash
    chmod u+r file.txt
    ```

<br>

3. `g-w`：對 `g 群組` `- 移除` `w 寫入` 權限。

    ```bash
    chmod g-w file.txt
    ```

<br>

4. `a+x`：給 `a 所有人` `+ 增加` `x 執行` 權限。

    ```bash
    chmod a+x file.txt
    ```

<br>

5. `755`：也可使用數字表示法，格式為三位數字，依序為 `使用者、群組、其他人`，每個數字是三種權限 設定權限對應值的加總；如下範例中，`7` 代表具有 `讀寫執行`、`5` 代表具有 `讀取和執行`。

    ```bash
    chmod 755 file.txt
    ```

<br>

6. `chmod` 權限操作的 _對象、動作、權限種類_ 對照如下；特別注意，這些符號並非參數，屬於模式字元。

    ```bash
    u：用戶 `user`，檔案擁有者

    g：群組 `group`，擁有該檔案群組的用戶

    o：其他人 `other`，不屬於擁有者或群組的用戶

    a：所有人 `all`，包含 u、g、o 三者

    r：讀取權限 `read`，可查看檔案內容，或列出目錄內容

    w：寫入權限 `write`，可修改檔案或在目錄內建立、刪除檔案

    x：執行權限 `execute`，可執行檔案，或進入目錄

    +：增加權限

    -：移除權限

    =：設為指定權限並覆蓋原有設定
    ```

<br>

7. 權限對應表中，三個欄位分別代表 `user`、`group`、`others`；每欄位的權限種以 `r = 4`、`w = 2`、`x = 1` 夾總表示；例如 `7=4+2+1`、`5=4+1`。

    ```bash
    chmod 755
    ```

<br>

## `chown`

_注意使用者或群組需存在系統中，否則會失敗_

<br>

1. 更改檔案擁有者，語法結構如下。

    ```bash
    # <帳號>：新文件擁有者的使用者名稱
    # <群組>：新文件群組的名稱
    # <檔案>：要更改擁有者和群組的目標文件或目錄
    chown <帳號>:<群組> <檔案>
    ```

<br>

2. 將 `file.txt` 的擁有者改為 `user1`，群組改為 `group1`。

    ```bash
    chown user1:group1 file.txt
    ```

<br>

3. 僅有一個參數時，表示僅指定新的使用者，並保留原本群組設定值；以下指令會將 `file.txt` 的擁有者改為 `user1`，群組保持不變。

    ```bash
    chown user1 file.txt
    ```

<br>

4. 承上，若僅要變更群組而保留使用，可使用以下表達方式，者將 `file.txt` 的群組改為 `group1`，擁有者保持不變。

    ```bash
    chown :group1 file.txt
    ```

<br>

5. 使用參數 `-R` 表達遞歸處理，針對指定目錄 `directory` 及其所有子文件和子目錄，將擁有者和群組改為 `user1:group1`。

    ```bash
    chown -R user1:group1 directory/
    ```

<br>

## `chgrp`

_僅修改群組時，除可使用 `chown :<群組>` 這樣的表達，也可使用指令 `chgrp` 進行操作_

<br>

1. 修改檔案或目錄的群組。

    ```bash
    chgrp group1 file.txt
    ```

<br>

2. 同時修改多個檔案的群組。

    ```bash
    chgrp group1 file1.txt file2.txt
    ```

<br>

3. 遞迴修改整個資料夾及其子項目的群組。

    ```bash
    chgrp -R group1 folder_name/
    ```

<br>

## `umask`

_權限遮罩值 `user file-creation mode mask`；新建立的檔案與目錄會被賦予預設權限，該權限會依據系統預設值與 `umask` 相減後的結果；`檔案預設`為 `666 - umask`，目錄則為 `777 - umask`。_

<br>

1. 顯示目前的 `umask` 設定值，通常為 `四位八進位數`；第一個數字通常為 `0`，這是個保留位，現今大多忽略，接下來三位為 `user/group/others`。

    ```bash
    umask
    ```

<br>

2. 修改 `umask` 值，僅影響目前 `shell session`；例如若要對 others `移除寫入` 權限可使用以下指令。

    ```bash
    # 將新建檔案的預設權限設為 664，目錄為 775
    umask 0002
    ```

<br>

3. 若要永久修改 `umask`，需寫入啟動設定檔如 `~/.bashrc` 或 `~/.profile`。

    ```bash
    # 在檔案中加入以下行
    umask 0022
    ```

<br>

4. 預設值為不允許群組與其他人寫入。

    ```bash
    # 644、755
    0022
    ```

<br>

5. 允許群組寫入，常見於協作開發。

    ```bash
    # 664、775
    0002
    ```

<br>

6. 僅限使用者本人可存取，較安全。

    ```bash
    # 600、700
    0077
    ```

<br>

## `stat`

1. 顯示檔案的詳細資訊，包括權限、link 數、大小與時間等。

    ```bash
    stat file.txt
    ```

<br>

___

_END_