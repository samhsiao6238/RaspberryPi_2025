# å°é–‰è³‡è¨Šæ¸¬è©¦

_é©—è­‰æ˜¯å¦ä½¿ç”¨å‘é‡æŸ¥è©¢çš„ RAG_

## å°é–‰æ¸¬è©¦è³‡æ–™

1. é€²å…¥å°ˆæ¡ˆä¸­ï¼Œå»ºç«‹è³‡æ–™å¤¾ `docs/private_docs/`ï¼Œå…§å«ä¸€å€‹æª”æ¡ˆ `sam_notes.txt`ã€‚

```bash
cd ~/Documents/exPostgreSQL
mkdir -p docs/private_docs
cd docs/private_docs
touch sam_notes.txt
```

2. ç·¨è¼¯å…§å®¹

```txt
ä½œè€…ï¼šSam  
å…§å®¹æ‘˜è¦ï¼šSam æ›¾æ–¼ 2025 å¹´ 4 æœˆè¨­è¨ˆä¸€å¥—è‡ªå‹•åŒ–å•ç­”ç³»çµ±ï¼Œå…¶æ ¸å¿ƒæŠ€è¡“ç‚º PostgreSQL + pgvectorã€‚  
è©²ç³»çµ±ä½¿ç”¨ LangChain æ­é… OpenAI Embeddings å°‡ç­†è¨˜å…§å®¹å‘é‡åŒ–å­˜å…¥è³‡æ–™åº«ï¼Œæœ€çµ‚é€éå‘é‡æ¯”å°é€²è¡Œå¿«é€ŸæŸ¥è©¢ã€‚

é€™å¥—ç³»çµ±çš„è¨­è¨ˆåˆè¡·ä¾†è‡ªæ–¼åœ˜éšŠçŸ¥è­˜åº«é›£ä»¥å³æ™‚æŸ¥æ‰¾èˆ‡ç¶­è­·çš„ç—›é»ã€‚Sam åœ¨å…§éƒ¨å°å…¥ `pgvector` æ“´å……æ¨¡çµ„ï¼Œå°‡æ¯æ®µæŠ€è¡“æ–‡ä»¶å…§å®¹ä»¥ OpenAI çš„ `text-embedding-ada-002` æ¨¡å‹è½‰æ›ç‚º 1536 ç¶­çš„å‘é‡ï¼Œå„²å­˜è‡³ PostgreSQL è³‡æ–™åº«ä¸­ã€‚æ¯ç­†è³‡æ–™åŒ…å« `id`ã€`content`ã€`metadata` èˆ‡ `embedding` å››æ¬„ä½ï¼Œä¸”å»ºç«‹äº† `ivfflat` å‘é‡ç´¢å¼•ä»¥åŠ é€Ÿè¿‘ä¼¼æŸ¥è©¢ã€‚

ç³»çµ±å‰ç«¯ä»¥ FastAPI å»ºç«‹ RESTful API æ¥å£ï¼Œå¾Œç«¯å‰‡åˆ©ç”¨ LangChain çš„ `RetrievalQA` æ¨¡çµ„ä¸²æ¥ ChatOpenAI æ¨¡å‹ï¼Œè®“ä½¿ç”¨è€…è¼¸å…¥æŸ¥è©¢å•é¡Œå¾Œå¯å–å¾—æ ¹æ“šèªæ„ç›¸ä¼¼å…§å®¹ç”Ÿæˆçš„ç­”æ¡ˆã€‚æ­¤å¤–ï¼ŒSam ä¹Ÿç‚ºç³»çµ±åŠ å…¥æ¬Šé‡åˆ†æ•¸éæ¿¾æ©Ÿåˆ¶ï¼Œé¿å…èª¤å¬å›èªæ„ä¸ç¬¦çš„æ®µè½ã€‚

ç¶“å…§éƒ¨æ¸¬è©¦ï¼Œè©²ç³»çµ±å°æ–¼ 3000 ç­†æŠ€è¡“æ–‡æª”çš„æŸ¥è©¢æº–ç¢ºç‡é” 92%ï¼Œå¹³å‡å›æ‡‰æ™‚é–“åƒ… 2.3 ç§’ï¼Œå¤§å¹…è¶…è¶ŠåŸæœ¬ä»¥é—œéµå­—æ¯”å°å¯¦ä½œçš„æŸ¥è©¢æ¨¡çµ„ã€‚æ­¤å°ˆæ¡ˆç›®å‰éƒ¨ç½²æ–¼å…¬å¸å…§éƒ¨ç§æœ‰é›²ç’°å¢ƒï¼Œæœªå°å¤–é–‹æ”¾ï¼Œä¸¦ä½œç‚º AI æ–‡ä»¶åŠ©ç†ç”¢å“é–‹ç™¼çš„åŸºç¤æ¨¡çµ„ã€‚
```

## é€²è¡Œæª¢é©—

1. å¥—ä»¶å®‰è£

```bash
pip install llama-index llama-index-vector-stores-postgres llama-index-embeddings-openai llama-index-llms-openai psycopg2-binary python-dotenv
```


2. å»ºç«‹å‘é‡ç´¢å¼•ä¸¦å¯«å…¥ PostgreSQLï¼ˆpgvectorï¼‰

```python
from llama_index.core import VectorStoreIndex, SimpleDirectoryReader
from llama_index.embeddings.openai import OpenAIEmbedding
from llama_index.vector_stores.postgres import PGVectorStore
from dotenv import load_dotenv
import os

# è¼‰å…¥ç’°å¢ƒè®Šæ•¸
load_dotenv()

# è®€å–æœ¬åœ°æª”æ¡ˆï¼ˆdocs/private_docs/sam_notes.txtï¼‰
documents = SimpleDirectoryReader(input_dir="./docs/private_docs").load_data()

# å»ºç«‹ pgvector å„²å­˜
vector_store = PGVectorStore.from_params(
    database="testdb",
    host="localhost",
    password=os.getenv("POSTGRES_PASSWORD"),
    user="postgres",
    port=5432,
    table_name="documents"
)

# å»ºç«‹ç´¢å¼•ä¸¦å­˜å…¥ pgvector
index = VectorStoreIndex.from_documents(
    documents,
    embed_model=OpenAIEmbedding(),
    vector_store=vector_store
)
```

3. ä½¿ç”¨å‘é‡æŸ¥è©¢é€²è¡Œç§å¯†è³‡æ–™æª¢ç´¢

```python
from llama_index.llms.openai import OpenAI
query_engine = index.as_query_engine(llm=OpenAI(model="gpt-3.5-turbo"))

# æ¸¬è©¦å•é¡Œï¼ˆåªæœ‰è³‡æ–™åº«çŸ¥é“ï¼‰
query = "èª°åœ¨ 2025 å¹´è¨­è¨ˆé PostgreSQL + pgvector å•ç­”ç³»çµ±ï¼Ÿ"

response = query_engine.query(query)
print("ğŸ¤– å›ç­”ï¼š", response)
```

4. è©¦è‘—æ”¹æˆéå‘é‡è³‡æ–™ä¸å­˜åœ¨çš„å…§å®¹

```python
query = "èª°åœ¨ 2019 å¹´ä½¿ç”¨ Firebase è¨“ç·´ LLMï¼Ÿ"
```
